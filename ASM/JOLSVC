           TITLE 'JOL SVC:SVC 34:READ/WRITE JOBQ MVS'
* THIS IS A MULTI-FUNCTION SVC FOR JOL.
* IT IS USED AT BOTH COMPILE AND EXECUTE TIME.
*
****** THERE ARE ONLY A FEW CHECKS TO VALIDATE THE CALLER, AND
* THESE COULD BE DUPLICATED BY ANY-ONE. HOWEVER, SVC 34 WILL
* PERFORM ITS OWN VALIDATIONS, AND THE OTHER ENTRY POINT IS
* USED PURELY FOR COPYING INFORMATION TO SUBPOOL 236, AND THE
* INFORMATION TO GO THERE WILL BE FAIRLY HEAVILY VALIDATED.
*
* AS AT 12/12/75, ONLY 3 FUNCTIONS ARE TO BE PERFORMED.
*
* FUNCTION 0
*    ISSUE SVC 34, USING THE UNFORMATION POINTED TO BY R1 AS THE
*          COMMAND.
*
* FUNCTION 1
*    COPY INFORMATION PROVIDED TO THE MVS JOBQ.
*
* FUNCTION 2
*    TURN OFF THE ALLOCATION BIT FOR HASP INTERNAL READERS
*
           SPACE
* SET UP REGISTER EQUATES
           REGEQU
UJESVC     CSECT
           USING UJESVC,R6     ADDRESS OURSELVES
* ON ENTRY, R0 CONTAINS:-
*          BITS 0-8 :- FUNCTION CODE
*          8-END    :- C'JOL'
*
* VALIDATE R0 A LITTLE ...
           LR  R8,R0
           SRL R8,24           DROP 'JOL'
           SLL R8,1            MULTIPLY BY 2 FOR BRANCH
           SLL R0,8            DROP FUNCTION CODE FROM R0
           C   R0,=C'JOL '     IS IT JOL ?
           BNE ABEND           NO, ABEND
* NOW CHECK FUNCTION CODE WITHIN LIMITS.
           CH  R8,=H'8'
           BH  ABEND
* OK, FUNCTION OK, BRANCH TO PROCESSING ROUTINES
           B   *+4(R8)
           B   SVC34           ISSUE SVC 34
           B   PUTJOBQ         COPY INFO TO SUBPOOL 236
           B   OFFALLOC        TURN OFF ALLOCATION BIT IN UCB
           SPACE 3
           TITLE 'SVC 34'
SVC34      SVC 34              ISSUE THE COMMAND
           BR  R14             RETURN TO CALLER
           TITLE 'COPY TO MVS JOBQ'
PUTJOBQ    EQU *
* ON ENTRY R1-> A QMPA SET UP FOR IEFQMRAW FOR MFT,MVT, VS1 SYSTEMS.
* SO R1-> IOPARAMS (SEE BELOW)
*    HOWEVER, +8 CONTAINS THE OPTION INDICATING READ/WRITE.
*          WE WILL ONLY ACCEPT 'WRITE', IE 3
*    THIS IS FIELD 'QMPOP'
*
*    THE FIELD 'QMPCL' POINTS TO THE EXTERNAL PARAMETER AREA,
*    WHICH CONTAINS:
*          DC  A(AREA_FROM_WHICH_RECORD_IS_TO_BE_WRITTEN)
*          DC  XL4'TTR' SEE NOTE BELOW
* NOTE *** IN MVS SYSTEMS, THIS IS A CORE ADDRESS.
*   MVS JOBQ HAS 176 BYTE RECORDS AS USUAL (AND SUPPOSEDLY THE
*          SAME AS NORMAL JOBQ RECORDS), BUT AT:-
*              -4  CONTAINS CL4'SIOT'|'JFCB' ETC
*              -8  CONTAINS
*                  X'NN'       RECORD TYPE
*                  X'0000'
*                  X'B0'       LENGTH OF RECORD
*              -12 CONTAINS
*                  X'80'
*                  AL3(*-4)    ADDRESS OF RECORD
*              -16             ? A NUMBER (F) OF SOME DESCRIPTION
* BY INSPECTION,(FROM AN MVS DUMP) WE HAVE
*
*          -4                  -8
*          SCTX                X'0C'
*          ACT                 X'01'
*          JFCB                X'1C'
*          SCT                 X'02'
*          SIOT                X'03'
*          JMR                 X'1B'
*          IWAB                X'25'
*          JCT                 X'00'
*          JFCX                X'1D'
*          PDIB                X'21'
*          DSEN                X'0F'
*
           SPACE 3
* WE HAVE TO VALIDATE THE RECORD, AND COPY IT BACK TO THE JOBQ.
           SPACE 1
* WE DO KNOW THAT THE RECORD TO BE WRITTEN BACK HAS NAMES (EG 'JFCB')
*    -32 FROM THE ACTUAL RECORD, SO WE CAN DO A COMPARE ON
*    THAT BEFORE COPYING IT BACK.
*
*
* CURRENTLY, THE ONLY RECORDS WE WANT TO WRITE BACK ARE
*
*    1.    SCT
*    2.    PDQ     (NAME PDIB ??)
*    3.    SIOT
*
